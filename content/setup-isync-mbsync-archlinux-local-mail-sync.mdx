---
title: Arch Linuxã§isync(mbsync)ã‚’ä½¿ã„ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«åŒæœŸã™ã‚‹
description: ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã«å»ºã¦ãŸãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«åŒæœŸã—ã¾ã™ã€‚ãã®ãŸã‚isync(mbsync)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
date: 2025-01-13
tags: ['ArchLinux','isync(mbsync)']
categories: ['å‚™å¿˜éŒ²', 'ã‚µãƒ¼ãƒãƒ¼', 'ãƒ¡ãƒ¼ãƒ«']
draft: true
---

# Arch Linuxã§isync(mbsync)ã‚’ä½¿ã„ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«åŒæœŸã™ã‚‹

[ä»¥å‰æ§‹ç¯‰ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼](/posts/build-mailserver-with-sendgrid-arch)ã«ã¤ã„ã¦ã€ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰ç§»è¡Œã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚
è¨­å®šãªã©ã®å…¥ã‚Œè¾¼ã¿ã¯å®Œäº†ã—ã¾ã—ãŸãŒã€æœ€ã‚‚å¤§äº‹ãªã‚¿ã‚¹ã‚¯ã¨ã—ã¦ã€ç¾åœ¨ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«ã‚ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚’ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã€[isync(mbsync)](https://wiki.archlinux.jp/index.php/Isync)ã‚’ä½¿ã„ã¾ã™ã€‚

[ãƒ¬ãƒã‚¸ãƒˆãƒª | sourceforge.net](https://sourceforge.net/p/isync/isync/ci/master/tree/)

isync(mbsync)ã¯ã€IMAPã§ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ãƒ­ãƒ¼ã‚«ãƒ«ã«ãã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’åŒæœŸã—ãŸã‚Šã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
æ„å¤–ã¨æ˜”ã‹ã‚‰ã‚ã‚‹ã‚“ã§ã™ãŒã€æœ€è¿‘ã§ã‚‚ã¡ã‚ƒã‚“ã¨æ›´æ–°ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‚ˆã†ãªç¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã®åŸºæœ¬æƒ…å ±ã¯[ã“ã¡ã‚‰](https://help.sakura.ad.jp/rs/2250/)ã§ã™ã€‚
ä½™è«‡ã§ã™ãŒã€ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã¯ã€è‡ªåˆ†ãŒå‹¤ã‚ã‚‹ä¼šç¤¾ã§ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚³ãƒ¼ãƒã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒˆã®EC2ã§å—ä¿¡ã—ãŸã„ã€ã¿ãŸã„ãªã“ã¨ã‚’è¨€ã„å‡ºã—ãŸãŠå®¢ã•ã‚“ã«ç´¹ä»‹ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

ãƒ¡ãƒ¼ãƒ«ã¯ã‚ˆãæ¯ã‚ŒãŸæŠ€è¡“ãªã©ã¨è¨€ã‚ã‚Œã¾ã™ãŒã€çµå±€çµ¶å¯¾ã«æ‰‹æ”¾ã›ãªã„gmailã‚‚iCloudã‚‚ã€Sendmail,PostfixåŒæ§˜SMTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ä»–ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã—ã¾ã™ã€‚ã¤ã¾ã‚‹ã¨ã“ã‚ã„ã¤ã¾ã§çµŒã£ã¦ã‚‚æ¶ˆãˆãªã„ã‚‚ã®ã¨å‹æ‰‹ã«æ€ã£ã¦ã„ã¾ã™ã€‚  
ãã®è¾ºã®ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚ã«å§‹ã‚ãŸãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒå¤‰ãªã¨ã“ã‚ã¾ã§æ¥ã¦ã—ã¾ã£ãŸæ„Ÿã˜ã§ã™ã€‚

## ç¾çŠ¶ãƒ»æ–¹é‡

### ç¾çŠ¶

ä¸€æ—¦ç¾çŠ¶ã‚’ã¾ã¨ã‚ã¾ã™ã€‚
postfix, Dovecot, SendGridã‚’çµ„ã¿åˆã‚ã›ãŸãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã«ã‚ˆã‚Šã€å¤–éƒ¨ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã‚’ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå—ä¿¡ã—ã¾ã™ã€‚
ãã®ãŸã‚ã®è»¢é€çµŒè·¯ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
Internet =[smtp]=> postfix =[lmtp]=> Dovecot(LMTP) => ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹
```

ã‚ã–ã‚ã–Dovecotã®LMTPã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ç†ç”±ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼ã¾ã‚ã‚Šã‚’postfix,dovecotã®ãã‚Œãã‚Œã§å…¨ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†ã‚’è¨­å®šã™ã‚‹ã®ã¯é¦¬é¹¿ã‚‰ã—ã„ã®ã§ã€ã©ã¡ã‚‰ã‹ã«æ©Ÿèƒ½ã‚’å¯„ã›ãŸã‹ã£ãŸãŸã‚ã€ã‚ˆã‚Šå¤šæ©Ÿèƒ½ãªDovecotã«èªè¨¼ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«é…é€ã‚‚ä»»ã›ã¦ã„ã‚‹å½¢ã§ã™ã€‚

### ä½œæ¥­æ–¹é‡

ä»¥ä¸Šã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã«ã¤ã„ã¦ã€ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã¨ã€å¤–éƒ¨ã®åŒæœŸå¯¾è±¡ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã®ã©ã‚Œã‹ãŒå¯¾å¿œã—ã¦ãŠã‚Šã€ãã‚Œã‚‰ã‚’isync(mbsync)ã‚’ä½¿ã£ã¦åŒæœŸã™ã‚‹ã®ãŒç›®æ¨™ã§ã™ã€‚

ãã®ãŸã‚ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã§é€²ã‚ã¾ã™ã€‚

1. isync(mbsync)ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ã¨ã‚Šã‚ãˆãšåŒæœŸã—ã¦ã¿ã‚‹
3. ã•ãã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã¨ã—ã¦ä½¿ã†ãŸã‚ã®åŒæœŸè¨­å®šã®æ¨¡ç´¢
4. ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–

## æ‰‹é †

### 1. isync(mbsync)ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯ã“ã‚ŒãŒãªã„ã¨å§‹ã¾ã‚Šã¾ã›ã‚“ã€‚

```
buntin in ğŸŒ badcompany in ~ via ğŸ v3.13.1 
â¯ paru -S isync  
resolving dependencies...
looking for conflicting packages...

Packages (1) isync-1.5.0-2

Total Download Size:   0.19 MiB
Total Installed Size:  0.55 MiB

:: Proceed with installation? [Y/n] 
:: Retrieving packages...
 isync-1.5.0-2-x86_64  199.5 KiB  1216 KiB/s 00:00 [##########################] 100%
(1/1) checking keys in keyring                     [##########################] 100%
(1/1) checking package integrity                   [##########################] 100%
(1/1) loading package files                        [##########################] 100%
(1/1) checking for file conflicts                  [##########################] 100%
(1/1) checking available disk space                [##########################] 100%
:: Processing package changes...
(1/1) installing isync                             [##########################] 100%
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
buntin in ğŸŒ badcompany in ~ via ğŸ v3.13.1 took 2s 
â¯ paru -Qi isync 
Name            : isync
Version         : 1.5.0-2
Description     : IMAP and MailDir mailbox synchronizer
Architecture    : x86_64
URL             : https://isync.sourceforge.io/
Licenses        : GPL2
Groups          : None
Provides        : None
Depends On      : libsasl  zlib
Optional Deps   : None
Required By     : None
Optional For    : None
Conflicts With  : None
Replaces        : None
Installed Size  : 564.10 KiB
Packager        : Jonathan Steel <jsteel@archlinux.org>
Build Date      : Sat 19 Oct 2024 10:52:23 PM JST
Install Date    : Tue 14 Jan 2025 08:55:13 AM JST
Install Reason  : Explicitly installed
Install Script  : No
Validated By    : Signature
buntin in ğŸŒ badcompany in xlog on î‚  main [!] via ğŸ¥Ÿ v1.1.39 via îœ˜ v23.4.0 
â¯ mbsync --version
isync 1.5.0
```

### 2. ã¨ã‚Šã‚ãˆãšåŒæœŸã—ã¦ã¿ã‚‹

ãªã‚“ã§ã“ã‚“ãªèˆã‚ãŸç« ã‚¿ã‚¤ãƒˆãƒ«ãªã®ã‹ã¨ã„ã†ã¨ã€ä½¿ã„æ–¹ãŒå…¨ãã‚ã‹ã‚‰ãªã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚æ€ã£ãŸä»¥ä¸Šã«è¤‡é›‘ã§ã—ãŸã€‚

ä½¿ã„æ–¹

#### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­ç½®

```
[vmail@badcompany ~]$ mkdir .config
[vmail@badcompany ~]$ cp /usr/share/doc/isync/examples/mbsyncrc.sample .config/isyncrc
```

```ini title="mbsyncrc.sample"
# Global configuration section
#   Values here are used as defaults for any following Channel section that
#   doesn't specify them.
Expunge None
Create Both

# More sections follow
#
# !!!! Note that empty lines delimit sections !!!!

MaildirStore local
Path ~/Mail/
Trash Trash


IMAPStore work
Host work.host.com
User tehuser
Pass xxxxxxxx
# Fetch password from gnome-keyring:
#PassCmd "gnome-keyring-query get mail_pw"
# Fetch password from .netrc:
#PassCmd "sed -n -e 's,^machine work\\.host\\.com login tehuser password \\(.*\\),\\1,p' < $HOME/.netrc"
# Fetch password from a gpg-encrypted file:
#PassCmd "gpg --quiet --for-your-eyes-only --decrypt $HOME/imappassword.gpg"
# Fetch password from pwmd (http://pwmd.sourceforge.net/):
#PassCmd "echo -ne 'GET myIsp\\tpassword' | pwmc datafile"

Channel work
Far :work:
Near :local:work
Expunge Near
Sync PullNew Push


IMAPStore personal
Host host.play.com
Port 6789
TLSType None

Channel personal
Far :personal:
Near :local:personal
Expunge Both
MaxMessages 150
MaxSize 200k

IMAPStore remote
Tunnel "ssh -q host.remote.com /usr/sbin/imapd"

Channel remote
Far :remote:
Near :local:remote


Group boxes
Channels work personal remote


# Due to the divergent Path suffixes, it's possible to have
# multiple Stores homed in the same directory.
# You could even put them all directly into $HOME.

MaildirStore local-personal
Path ~/Mail/personal-
Inbox ~/Mail/personal-INBOX

MaildirStore local-work
Path ~/Mail/work-
# Just because.
Inbox ~/Mail/w0rk_InBoX

Channel personal-joined
Far :personal:
Near :local-personal:
Paterns *

Channel work-joined
Far :work:
Near :local-work:
Paterns *

Group joined personal-joined work-joined


IMAPStore st1
Host st1.domain.com
AuthMech CRAM-MD5
# Omit if you want to use the system certificate store.
CertificateFile ~/.st1-certificate.crt

IMAPStore st2
Host imap.another-domain.com
Path non-standard/
TLSVersions -1.2

Channel rst
Far :st1:somebox
Near :st2:


IMAPAccount server
Host imaps:foo.bar.com
# Omit if you want to use the system certificate store.
CertificateFile ~/.server-certificate.crt

IMAPStore server
Account server
MapInbox inbox
Trash ~/trash
TrashRemoteNew yes

MaildirStore mirror
Path ~/Maildir/
SubFolders Verbatim

Channel o2o
Far :server:
Near :mirror:
Patterns %

Group partial o2o:inbox,sent-mail,foobar

# INBOX => server, INBOX.foo => server.foo, etc.
Channel inbox
Far :server:INBOX
Near :mirror:server
Patterns *
```

ä½•ã‚„ã‚‰èª¬æ˜ã®ãŸã‚ã«ã‹ãªã‚Šã®è¨­å®šãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€è¨­å®šã¯å¤§ããä»¥ä¸‹ã®4ã¤ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚

1. ã‚¹ãƒˆã‚¢(Store)

ã‚¹ãƒˆã‚¢ã¯ã€ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã®ã“ã¨ã§ã™ã€‚1ãƒ¡ãƒ¼ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã®èªè¨¼æƒ…å ±ã€ã¨ã„ã†ç†è§£ã§å•é¡Œãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚



