---
title: さくらから移行 | FreeBSDにメールサーバーを構築する
description: さくらのメールボックスから移行します
date: 2024-05-27
tags: ['AWS', 'メール', 'FreeBSD']
categories: ['備忘録', '構築', 'メール']
keywords: ['postfix', 'dovecot', 'FreeBSD', 'メールサーバー', 'さくらのメールボックス', '移行']
draft: true
---

# 自宅サーバーでメールサーバーを構築する

## はじめに

現在、特に理由なく自分が持っているドメインでメールを運用しています。

一年で数百円程度の費用でさくらのメールボックスを使っていました。
費用的にも最強だと思っていますが、メールのみ外部に依存しているのは、
メールだけ諦めたみたいな感じで嫌だったので、別に新しくメールサーバーを建てることにしました。
また、FreeBSD にしたのは気分です。zfs の上に win と mac 共用の FTP サーバーを建てたいなと本当に気まぐれに思いつきました。
以前友人と秋葉の地下街で買ってきた ThinkCentre にインストールしました。
それまでは MiracleLinux9 が入っていたのですが、なんかミラー先が謎に死んでいたのでサイバートラストに対する信頼を無くしました。
なので消しました。

そのような経緯があり、自宅にある FreeBSD にメールサーバーを構築していきます。Linux で建てるのとは、postfix,dovecot のインストールくらいまでは違う手順になりますが、ほぼ一緒だと思います。

また、一つ面倒なのが、ほとんどの家がそうだと思いますが、自宅回線なので、IP が動的というのと、OP25B の影響を受けます。
IP が動的というのは、Cloudflare API で違うサーバーで動いているデーモンがうまいこと設定してくれます。しかし、OP25B は結構厄介です。
Outbound Port 25 Blocking の略ですが、読んで字の如く 25 ポートから出ていくトラフィックを ISP がブロックします。
だるいですが、実際ないと多分迷惑メールがやばいことになるので許します。まあ迷惑メールがなくなったわけじゃないんで、悪影響しか受けない自分は普通に最悪の気分です。今の時代騙される奴なんて中々いないだろうに、クソみたいなメールを送ることで俺みたいな善良な人間にも迷惑をかけるクラッカー、ガチで ○ んどけ。

## おおまかな流れ

小出しにするのも変なので、OP25B の回避策含めやることをまとめます。
作業する自分のためという側面が大きいです。

1. 設定するドメインを取得する(決める)
2. FreeBSD に postfix,dovecot をインストール、設定
3. さくらで使用しているユーザーを作成する
4. mbsync(isync)を利用しさくらのメールボックスからメールを移行する
5. SPF を設定し送信テストをする
6. DKIM を設定し送信テストをする

OP25B 回避については、Nuro のメールサーバーをリレーとして使います。
